/*! For license information please see webvrhelper.min.js.LICENSE.txt */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.WebVRHelper=t():e.WebVRHelper=t()}(self,(function(){return(()=>{"use strict";var e={d:(t,n)=>{for(var s in n)e.o(n,s)&&!e.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:n[s]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{default:()=>n});const n={supportsXR:!1,supportsVR:!1,supportsStereoView:!1,renderer:null,sessionChangeCallback:null,onVRAvailabilityCallback:null,currentXRSession:null,currentVRDisplay:null,sessionActive:!1,stereoEffectActive:!1,fullscreenSupported:!1,checkAvailabilityLoose:function(){return"xr"in navigator&&"isSessionSupported"in navigator.xr||"getVRDisplays"in navigator||navigator.userAgent.match(/SamsungBrowser|OculusBrowser|Firefox/i)&&navigator.userAgent.match(/Mobile VR/i)||this.checkFullscreenSupport()},checkAvailabilityFull:function(e){this.onVRAvailabilityCallback=e,this.checkXRAvailability()},postAvailabilitySetup:function(e,t,n,s,i){return e?(this.renderer=e,this.StereoEffectClass=t||(window.THREE?window.THREE.StereoEffect:null),this.supportsStereoView&&!this.StereoEffectClass?(console.error("Supports Stereo View but StereoEffect class hasn't been passed. Aborting!"),void(this.supportsStereoView=!1)):(this.sessionChangeCallback=n,!!i&&"setReferenceSpaceType"in this.renderer.xr&&this.renderer.xr.setReferenceSpaceType(i),!!s&&"SamsungChangeSky"in window&&window.SamsungChangeSky(s),void(this.supportsXR?(this.onXRSessionStarted=function(e){e.addEventListener("end",this.onXRSessionEnded),this.renderer.xr.setSession(e),this.currentXRSession=e,this.sessionActive=!0,this.sessionChangeCallback&&this.sessionChangeCallback()}.bind(this),this.onXRSessionEnded=function(){this.currentXRSession.removeEventListener("end",this.onXRSessionEnded),this.renderer.xr.setSession(null),this.currentXRSession=null,this.sessionActive=!1,this.sessionChangeCallback&&this.sessionChangeCallback()}.bind(this),this.errorOnXRSessionRequest=function(e){console.log("Error while requesting XR session. Removing XR support flag.",e),this.supportsXR=!1}.bind(this)):this.supportsVR?(this.renderer.xr.enabled=!0,this.onVRDisplayConnectDisconnect=function(e){this.currentVRDisplay=e,this.renderer.xr.setDevice(this.currentVRDisplay),this.sessionChangeCallback&&this.sessionChangeCallback()},window.addEventListener("vrdisplayconnect",function(e){this.onVRDisplayConnectDisconnect(e.display)}.bind(this),!1),window.addEventListener("vrdisplaydisconnect",function(){this.onVRDisplayConnectDisconnect(null)}.bind(this),!1),window.addEventListener("vrdisplaypresentchange",function(e){this.sessionActive=e.display.isPresenting,this.sessionChangeCallback&&this.sessionChangeCallback()}.bind(this),!1),window.addEventListener("vrdisplayactivate",function(e){e.display.requestPresent([{source:this.renderer.domElement}])}.bind(this),!1)):this.supportsStereoView&&(this.isInFullScreen=function(){return document.fullscreenElement&&null!==document.fullscreenElement||document.webkitFullscreenElement&&null!==document.webkitFullscreenElement||document.mozFullScreenElement&&null!==document.mozFullScreenElement||document.msFullscreenElement&&null!==document.msFullscreenElement},this.enterExitFullscreen=function(e){e?document.documentElement.requestFullscreen?document.documentElement.requestFullscreen():document.documentElement.msRequestFullscreen?document.documentElement.msRequestFullscreen():document.documentElement.mozRequestFullScreen?document.documentElement.mozRequestFullScreen():document.documentElement.webkitRequestFullscreen&&document.documentElement.webkitRequestFullscreen():document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen()},this.onFullscreenChange=function(){!this.isInFullScreen()&&this.stereoEffectActive&&this.startStopVRSession()}.bind(this),document.documentElement.requestFullscreen?document.documentElement.addEventListener("fullscreenchange",this.onFullscreenChange):document.documentElement.msRequestFullscreen?document.documentElement.addEventListener("msfullscreenchange",this.onFullscreenChange):document.documentElement.mozRequestFullScreen?document.documentElement.addEventListener("mozfullscreenchange",this.onFullscreenChange):document.documentElement.webkitRequestFullscreen&&document.documentElement.addEventListener("webkitfullscreenchange",this.onFullscreenChange))))):void console.error("three.js renderer is not found. Aborting!")},checkFullscreenSupport:function(){return this.fullscreenSupported=this.fullscreenSupported||!!(document.documentElement.requestFullscreen||document.documentElement.msRequestFullscreen||document.documentElement.mozRequestFullScreen||document.documentElement.webkitRequestFullscreen),this.fullscreenSupported},checkXRAvailability:function(){"xr"in navigator&&"isSessionSupported"in navigator.xr?navigator.xr.isSessionSupported("immersive-vr").then(function(e){e?(this.supportsXR=!0,this.endOfAvailabilityCheck()):this.checkLegacyVRAvailability()}.bind(this)).catch(function(e){console.log("Error while checking native XR support. Moving on to checking native legacy VR support.",e),this.checkLegacyVRAvailability()}.bind(this)):this.checkLegacyVRAvailability()},checkLegacyVRAvailability:function(){"getVRDisplays"in navigator?navigator.getVRDisplays().then(function(e){0<e.length?(this.currentVRDisplay=e[0],this.supportsVR=!0,this.endOfAvailabilityCheck()):this.checkStereoViewAvailability()}.bind(this)).catch(function(e){console.log("Error while checking native legacy VR support. Moving on to checking three.js stereo view support.",e),this.checkStereoViewAvailability()}.bind(this)):this.checkStereoViewAvailability()},checkStereoViewAvailability:function(){this.supportsStereoView=this.checkFullscreenSupport(),this.endOfAvailabilityCheck()},endOfAvailabilityCheck:function(){console.log("supportsXR: "+this.supportsXR),console.log("supportsVR: "+this.supportsVR),console.log("supportsStereoView: "+this.supportsStereoView),this.onVRAvailabilityCallback&&this.onVRAvailabilityCallback(this.isAnyVRSupported())},startStopVRSession:function(){this.supportsXR?null===this.currentXRSession?navigator.xr.requestSession("immersive-vr").then(this.onXRSessionStarted).catch(this.errorOnXRSessionRequest):this.currentXRSession.end():this.supportsVR&&this.currentVRDisplay?this.currentVRDisplay.isPresenting?this.currentVRDisplay.exitPresent():(this.renderer.xr.setDevice(this.currentVRDisplay),this.currentVRDisplay.requestPresent([{source:this.renderer.domElement}])):this.supportsStereoView&&(this.stereoEffectActive=!this.stereoEffectActive,this.stereoEffectActive?(!this.currentStereoEffect&&(this.currentStereoEffect=new this.StereoEffectClass(this.renderer)),this.currentStereoEffect.setSize(window.innerWidth,window.innerHeight),this.currentStereoEffect.setEyeSeparation(.03175),this.enterExitFullscreen(!0)):(this.currentStereoEffect=null,this.renderer.setSize(window.innerWidth,window.innerHeight,!1)),this.sessionChangeCallback&&this.sessionChangeCallback())},isAnyVRSupported:function(){return this.supportsXR||this.supportsVR||this.supportsStereoView},inVRView:function(){return this.stereoEffectActive||this.sessionActive},onResize:function(){this.stereoEffectActive&&this.currentStereoEffect&&this.currentStereoEffect.setSize(window.innerWidth,window.innerHeight)},render:function(e,t){this.stereoEffectActive&&this.currentStereoEffect?this.currentStereoEffect.render(e,t):this.renderer.render(e,t)}};return t})()}));